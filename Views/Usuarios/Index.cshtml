@model IEnumerable<Inventarios.Models.UsuarioRolViewModel>
@{
    ViewData["Title"] = "GestiÃ³n de Usuarios";
    var usuarios = Model?.ToList() ?? new List<Inventarios.Models.UsuarioRolViewModel>();
}

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1>ğŸ‘¥ GestiÃ³n de Usuarios</h1>
        <p class="text-muted">Administra usuarios y roles del sistema</p>
    </div>
    <a asp-action="Crear" class="btn btn-primary btn-lg">
        â• Nuevo Usuario
    </a>
</div>

<!-- BÃšSQUEDA -->
<div class="card mb-4">
    <div class="card-body">
        <div class="input-group">
            <span class="input-group-text">ğŸ”</span>
            <input type="text" id="searchInput" class="form-control" 
                   placeholder="Buscar por correo..." />
        </div>
    </div>
</div>

@if (usuarios.Count > 0)
{
    <!-- TABLA DE USUARIOS -->
    <div class="table-responsive">
        <table class="table table-hover" id="usuariosTable">
            <thead>
                <tr>
                    <th>ğŸ“§ Correo</th>
                    <th>ğŸ‘¤ Rol(es)</th>
                    <th>âš™ï¸ Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var usuario in usuarios)
                {
                    var roles = usuario.Roles ?? new List<string>();
                    <tr>
                        <td>
                            <strong>@usuario.Correo</strong>
                        </td>
                        <td>
                            @if (roles.Count > 0)
                            {
                                @foreach (var rol in roles)
                                {
                                    var badgeClass = rol == "Admin" ? "badge bg-danger text-white" : "badge bg-success text-white";
                                    <span class="@badgeClass me-2">
                                        @if (rol == "Admin")
                                        {
                                            <span>ğŸ”´ @rol</span>
                                        }
                                        else
                                        {
                                            <span>ğŸŸ¢ @rol</span>
                                        }
                                    </span>
                                }
                            }
                            else
                            {
                                <span class="badge bg-secondary text-white">âš ï¸ Sin rol</span>
                            }
                        </td>
                        <td>
                            <a class="btn btn-sm btn-outline-primary" asp-action="Detalle" asp-route-id="@usuario.Id">
                                ğŸ‘ï¸ Ver
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- ESTADÃSTICAS -->
    <div class="row mt-5">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="card-title text-primary">@usuarios.Count</h3>
                    <p class="card-text">ğŸ‘¥ Total de Usuarios</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="card-title text-danger">@usuarios.Count(u => u.Roles?.Contains("Admin") == true)</h3>
                    <p class="card-text">ğŸ”´ Administradores</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="card-title text-success">@usuarios.Count(u => u.Roles?.Contains("Usuario") == true)</h3>
                    <p class="card-text">ğŸŸ¢ Usuarios</p>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-info alert-lg text-center p-5" role="alert">
        <h4>ğŸ“­ No hay usuarios registrados</h4>
        <p class="mb-0">
            <a asp-action="Crear" class="alert-link">Crear el primer usuario</a>
        </p>
    </div>
}

@section Scripts {
    <script>
        // BÃºsqueda en tabla
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const filter = this.value.toUpperCase();
            const table = document.getElementById('usuariosTable');
            const rows = table?.querySelectorAll('tbody tr') || [];

            rows.forEach(row => {
                const text = row.textContent.toUpperCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    </script>
}
