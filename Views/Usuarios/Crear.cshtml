@model Inventarios.Models.UsuarioCrearViewModel
@{
    ViewData["Title"] = "Crear Nuevo Usuario";
}

<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- HEADER -->
        <div class="mb-4">
            <h1>‚ûï Crear Nuevo Usuario</h1>
            <p class="text-muted">Registra un nuevo usuario en el sistema</p>
        </div>

        <!-- FORMULARIO -->
        <div class="form-container">


            <form asp-action="Crear" method="post" novalidate>
                <!-- Validaci√≥n General -->
                <div asp-validation-summary="ModelOnly" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <strong>‚ö†Ô∏è Error en el formulario:</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- SECCI√ìN: INFORMACI√ìN B√ÅSICA -->
                <fieldset class="mb-4 p-3 border rounded bg-light">
                    <legend class="mb-3">üìù Informaci√≥n B√°sica</legend>

                    <!-- Correo -->
                    <div class="form-group mb-3">
                        <label asp-for="Correo" class="form-label">üìß Correo Electr√≥nico</label>
                        <input asp-for="Correo" class="form-control form-control-lg" 
                               type="email"
                               placeholder="usuario@example.com" 
                               required />
                        <small class="form-text text-muted">Se usar√° como nombre de usuario</small>
                        <span asp-validation-for="Correo" class="text-danger"></span>
                    </div>
                </fieldset>

                <!-- SECCI√ìN: SEGURIDAD -->
                <fieldset class="mb-4 p-3 border rounded bg-light">
                    <legend class="mb-3">üîê Seguridad</legend>

                    <!-- Contrase√±a -->
                    <div class="form-group mb-3">
                        <label asp-for="Contrasena" class="form-label">Contrase√±a</label>
                        <div class="input-group">
                            <input asp-for="Contrasena" class="form-control form-control-lg" 
                                   type="password" id="passwordInput"
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                   required />
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                üëÅÔ∏è Ver
                            </button>
                        </div>
                        <small class="form-text text-muted">
                            M√≠nimo 6 caracteres: n√∫meros, letras min√∫sculas
                        </small>
                        <span asp-validation-for="Contrasena" class="text-danger"></span>
                        <div id="passwordStrength" class="mt-2">
                            <small>Fortaleza:</small>
                            <div class="progress" style="height: 20px;">
                                <div id="strengthBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Confirmar Contrase√±a -->
                    <div class="form-group mb-3">
                        <label asp-for="ConfirmarContrasena" class="form-label">Confirmar Contrase√±a</label>
                        <input asp-for="ConfirmarContrasena" class="form-control form-control-lg" 
                               type="password"
                               placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                               required />
                        <span asp-validation-for="ConfirmarContrasena" class="text-danger"></span>
                    </div>
                </fieldset>

                <!-- SECCI√ìN: ROLES -->
                <fieldset class="mb-4 p-3 border rounded bg-light">
                    <legend class="mb-3">üîë Asignar Rol</legend>

                    @if (ViewBag.Roles != null)
                    {
                        <div class="form-group mb-3">
                            <label asp-for="Rol" class="form-label">Rol del Usuario</label>
                            <select asp-for="Rol" asp-items="new SelectList(ViewBag.Roles)" class="form-select form-select-lg" required>
                                <option value="">-- Selecciona un rol --</option>
                            </select>
                            <small class="form-text text-muted">Determina los permisos del usuario</small>
                            <span asp-validation-for="Rol" class="text-danger"></span>
                        </div>

                        <!-- Descripci√≥n de Roles -->
                        <div class="alert alert-info" role="alert">
                            <strong>Informaci√≥n sobre Roles:</strong>
                            <div id="roleDescription" class="mt-2">
                                <em class="text-muted">Selecciona un rol para ver su descripci√≥n</em>
                            </div>
                        </div>
                    }
                </fieldset>



                <!-- BOTONES DE ACCI√ìN -->
                <div class="d-flex gap-2 justify-content-between">
                    <a asp-action="Index" class="btn btn-secondary btn-lg">
                        ‚Üê Volver al Listado
                    </a>
                    <button type="submit" class="btn btn-success btn-lg">
                        üíæ Crear Usuario
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Toggle password visibility
        document.getElementById('togglePassword')?.addEventListener('click', function() {
            const input = document.getElementById('passwordInput');
            const button = this;
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà Ocultar';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è Ver';
            }
        });

        // Validador de fortaleza de contrase√±a
        document.getElementById('Contrasena')?.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            const strengthBar = document.getElementById('strengthBar');

            // Longitud
            if (password.length >= 6) strength += 25;
            if (password.length >= 8) strength += 25;

            // Contiene n√∫meros
            if (/[0-9]/.test(password)) strength += 25;

            // Contiene letras min√∫sculas
            if (/[a-z]/.test(password)) strength += 25;

            // Actualizar barra
            strengthBar.style.width = strength + '%';
            
            if (strength < 50) {
                strengthBar.className = 'progress-bar bg-danger';
            } else if (strength < 75) {
                strengthBar.className = 'progress-bar bg-warning';
            } else {
                strengthBar.className = 'progress-bar bg-success';
            }
        });

        // Descripci√≥n de rol
        document.getElementById('Rol')?.addEventListener('change', function() {
            const rol = this.value;
            const description = document.getElementById('roleDescription');

            const roles = {
                'Admin': '<strong>üî¥ Administrador:</strong><br>Acceso total al sistema. Puede crear, editar y eliminar herramientas, gestionar usuarios y confirmar devoluciones.',
                'Usuario': '<strong>üü¢ Usuario Regular:</strong><br>Acceso limitado. Puede ver inventario, solicitar pr√©stamos y solicitar devoluciones.'
            };

            description.innerHTML = roles[rol] || '<em class="text-muted">Selecciona un rol para ver su descripci√≥n</em>';
        });

        // Validar que las contrase√±as coincidan
        document.querySelector('form')?.addEventListener('submit', function(e) {
            const password = document.getElementById('Contrasena').value;
            const confirm = document.getElementById('ConfirmarContrasena').value;

            if (password !== confirm) {
                e.preventDefault();
                alert('Las contrase√±as no coinciden');
                return false;
            }
        });
    </script>
}
